# buf.gen.yaml - Multi-language code generation configuration
# Documentation: https://buf.build/docs/configuration/v2/buf-gen-yaml
#
# IMPORTANT: Update the go_package_prefix to match your service name
# Example: gitlab.com/gitops-poc-dzha/api/gen/user-service/go
#
# This configuration generates gRPC code for:
# - Go (protoc-gen-go + protoc-gen-go-grpc)
# - Node.js/TypeScript (protobuf-ts)
# - Python (grpcio-tools)
# - PHP (protoc-gen-php + grpc_php_plugin)
# - Angular/gRPC-Web (grpc-web)

version: v2

# Managed mode ensures consistent options across all plugins
managed:
  enabled: true
  override:
    # CHANGE THIS to match your service name
    - file_option: go_package_prefix
      value: gitlab.com/gitops-poc-dzha/api/gen/example-service/go

plugins:
  # ===========================================
  # Go Generation
  # ===========================================
  # Generates message types (.pb.go files)
  - remote: buf.build/protocolbuffers/go
    out: gen/go
    opt:
      - paths=source_relative

  # Generates gRPC service stubs (_grpc.pb.go files)
  - remote: buf.build/grpc/go
    out: gen/go
    opt:
      - paths=source_relative
      - require_unimplemented_servers=false

  # ===========================================
  # Node.js/TypeScript Generation
  # ===========================================
  # Uses protobuf-ts for modern TypeScript support
  # Features: type-safe clients, async/await, tree-shaking
  - remote: buf.build/community/timostamm-protobuf-ts
    out: gen/nodejs
    opt:
      - long_type_string
      - generate_dependencies
      - output_typescript
      - server_grpc1
      - client_grpc1

  # ===========================================
  # Python Generation
  # ===========================================
  # Generates message types (_pb2.py files)
  - remote: buf.build/protocolbuffers/python
    out: gen/python

  # Generates gRPC service stubs (_pb2_grpc.py files)
  - remote: buf.build/grpc/python
    out: gen/python

  # Generates type stubs for IDE support (.pyi files)
  - remote: buf.build/protocolbuffers/pyi
    out: gen/python

  # ===========================================
  # PHP Generation
  # ===========================================
  # Generates message classes
  - remote: buf.build/protocolbuffers/php
    out: gen/php

  # Generates gRPC client stubs
  - remote: buf.build/grpc/php
    out: gen/php

  # ===========================================
  # Angular/gRPC-Web Generation
  # ===========================================
  # Generates browser-compatible gRPC-Web clients
  # Requires Envoy or grpcwebproxy for runtime
  - remote: buf.build/grpc/web
    out: gen/angular
    opt:
      - import_style=typescript
      - mode=grpcweb
